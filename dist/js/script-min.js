"use strict";let services=document.querySelector(".calculator-services"),slider=document.querySelector("#volume"),slider_min=document.querySelector(".calculator-slider__value--min"),slider_max=document.querySelector(".calculator-slider__value--max"),slider_value=document.querySelector(".slider-value"),intres_value=document.querySelector(".intres-value"),instalment=document.querySelector("#instalment"),contract_value=document.querySelector(".contract-value"),contract_free=document.querySelector(".contract-fee"),contract_period=document.querySelector(".contract-period"),contract_total=document.querySelector(".contract-total"),period_select=document.querySelector("#period"),monthly_payment=document.querySelector(".monthly-payment"),btn=document.querySelector(".calculator__btn"),btn_close=document.querySelector(".close"),popup=document.querySelector(".popup"),runningValue=document.querySelector(".js-value");async function getResponse(){let e=await fetch("data.json"),t=await e.json();for(let e in t)for(let n in t[e]){let l=document.createElement("label"),r=document.createElement("input"),u=document.createElement("span");r.setAttribute("type","checkbox"),l.classList.add("service-item"),u.classList.add("checkmark"),l.innerHTML=t[e][n].name,services.append(l),l.append(r),l.append(u),r.addEventListener("change",function(){if(r.checked){let i=document.querySelectorAll("input[type=checkbox]");for(let e of i)e.checked=!1,e.parentElement.style.background="white";if(r.checked=!0,r.parentElement.style.background="#f7fafa",this.parentElement.textContent===t[e][n].name){slider.setAttribute("min",t[e][n].price_range[0]),slider.setAttribute("max",t[e][n].price_range[1]),slider_min.innerHTML=t[e][n].price_range[0]+" €",slider_max.innerHTML=t[e][n].price_range[1]+" €",slider.value=t[e][n].default_value,slider_value.value=t[e][n].default_value,contract_period.innerHTML=t[e][n].default_period+" kuud";let r=0,i=0,a=0;function l(){let l=0;for(let u in t[e][n].intres){l++;let o=Number(slider.value);0==a?slider_value.value=o:(slider_value.value=a,slider_value.value>t[e][n].price_range[1]?(a=t[e][n].price_range[1],slider_value.value=a):slider_value.value<t[e][n].price_range[0]?(a=t[e][n].price_range[0],slider_value.value=a):slider.value=a);let c=u.split("-")[0],d=u.split("-")[1];if(o>c&&o<d){intres_value.innerHTML=t[e][n].intres[u],contract_value.innerHTML=t[e][n].contract_fee[l-1]+" €",contract_free.innerHTML=t[e][n].monthly_fee[l-1]+" €";let a,o,c,d=period_select.querySelectorAll("option");for(let e of d)e.remove();for(let u=1;u<=t[e][n].period[l-1]/6;u++){let l=document.createElement("option");l.innerHTML=6*u+" kuud",period_select.append(l),period_select.value=0==r?t[e][n].default_period+" kuud":r+" kuud"}a=0==r?(Number(slider.value)*t[e][n].intres[u].split("%")[0]/100+Number(slider.value)-i)/t[e][n].default_period:(Number(slider.value)*t[e][n].intres[u].split("%")[0]/100+Number(slider.value)-i)/r,o=0==r?t[e][n].contract_fee[l-1]/t[e][n].default_period:t[e][n].contract_fee[l-1]/r;let s=t[e][n].monthly_fee[l-1];c=0==r?(a+o+s)*t[e][n].default_period:(a+o+s)*r,monthly_payment.innerHTML=(a+o+s).toFixed(2)+" €",contract_total.innerHTML=c.toFixed(2)+" €"}}}function u(){a=slider_value.value}l(),period_select.value=t[e][n].default_period+" kuud",period_select.addEventListener("input",function(){contract_period.innerHTML=period_select.value,r=Number(period_select.value.split("kuud")[0]),l()}),slider.addEventListener("input",function(){let e=slider.value;runningValue.innerHTML=slider.value,runningValue.style.left=e/255+"%",runningValue.style.display="block",a=slider.value,l()}),slider.addEventListener("mouseup",function(){runningValue.style.display="none"}),instalment.addEventListener("focusout",function(){valuefunc(),l()}),instalment.addEventListener("keypress",function(e){13===e.keyCode&&((i=Number(instalment.value))>=slider.value?(i=0,instalment.value=0,instalment.style.borderBottom="3px solid #e03416"):instalment.style.borderBottom="3px solid #99a0a6",l())}),slider_value.addEventListener("focusout",function(){u(),l()}),slider_value.addEventListener("keypress",function(e){13===e.keyCode&&(u(),l())})}}else location.reload(!0)})}}getResponse(),btn.addEventListener("click",function(){popup.style.display="block"}),btn_close.addEventListener("click",function(){popup.style.display="none"});
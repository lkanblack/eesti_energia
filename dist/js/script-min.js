"use strict";let services=document.querySelector(".calculator-services"),slider=document.querySelector("#volume"),slider_min=document.querySelector(".calculator-slider__value--min"),slider_max=document.querySelector(".calculator-slider__value--max"),slider_value=document.querySelector(".slider-value"),intres_value=document.querySelector(".intres-value"),instalment=document.querySelector("#instalment"),contract_value=document.querySelector(".contract-value"),contract_free=document.querySelector(".contract-fee"),contract_period=document.querySelector(".contract-period"),contract_total=document.querySelector(".contract-total"),period_select=document.querySelector("#period"),monthly_payment=document.querySelector(".monthly-payment"),btn=document.querySelector(".calculator__btn"),btn_close=document.querySelector(".close"),popup=document.querySelector(".popup");async function getResponse(){let e=await fetch("../data.json"),t=await e.json();for(let e in t)for(let n in t[e]){let r=document.createElement("label"),l=document.createElement("input"),o=document.createElement("span");l.setAttribute("type","checkbox"),r.classList.add("service-item"),o.classList.add("checkmark"),r.innerHTML=t[e][n].name,services.append(r),r.append(l),r.append(o),l.addEventListener("change",function(){if(l.checked){let i=document.querySelectorAll("input[type=checkbox]");for(let e of i)e.checked=!1,e.parentElement.style.background="white";if(l.checked=!0,l.parentElement.style.background="#f7fafa",this.parentElement.textContent===t[e][n].name){slider.setAttribute("min",t[e][n].price_range[0]),slider.setAttribute("max",t[e][n].price_range[1]),slider_min.innerHTML=t[e][n].price_range[0]+" €",slider_max.innerHTML=t[e][n].price_range[1]+" €",slider.value=t[e][n].default_value,slider_value.value=t[e][n].default_value,contract_period.innerHTML=t[e][n].default_period+" kuud";let l=0,i=0,c=0;function r(){let r=0;for(let o in t[e][n].intres){r++;let u=Number(slider.value);0==c?slider_value.value=u:(slider_value.value=c,slider_value.value>t[e][n].price_range[1]?(c=t[e][n].price_range[1],slider_value.value=c):slider.value=c);let a=o.split("-")[0],d=o.split("-")[1];if(u>a&&u<d){intres_value.innerHTML=t[e][n].intres[o],contract_value.innerHTML=t[e][n].contract_fee[r-1]+" €",contract_free.innerHTML=t[e][n].monthly_fee[r-1]+" €";let c,u,a,d=period_select.querySelectorAll("option");for(let e of d)e.remove();for(let o=1;o<=t[e][n].period[r-1]/6;o++){let r=document.createElement("option");r.innerHTML=6*o+" kuud",period_select.append(r),period_select.value=0==l?t[e][n].default_period+" kuud":l+" kuud"}c=0==l?(Number(slider.value)*t[e][n].intres[o].split("%")[0]/100+Number(slider.value)-i)/t[e][n].default_period:(Number(slider.value)*t[e][n].intres[o].split("%")[0]/100+Number(slider.value)-i)/l,u=0==l?t[e][n].contract_fee[r-1]/t[e][n].default_period:t[e][n].contract_fee[r-1]/l;let s=t[e][n].monthly_fee[r-1];a=0==l?(c+u+s)*t[e][n].default_period:(c+u+s)*l,monthly_payment.innerHTML=(c+u+s).toFixed(2)+" €",contract_total.innerHTML=a.toFixed(2)+" €"}}}function o(){c=slider_value.value}r(),period_select.value=t[e][n].default_period+" kuud",period_select.addEventListener("input",function(){contract_period.innerHTML=period_select.value,l=Number(period_select.value.split("kuud")[0]),r()}),slider.addEventListener("input",function(){c=slider.value,r()}),instalment.addEventListener("focusout",function(){valuefunc(),r()}),instalment.addEventListener("keypress",function(e){13===e.keyCode&&((i=Number(instalment.value))>slider.value?(i=0,instalment.style.borderBottom="3px solid #e03416",instalment.value=0):instalment.style.borderBottom="3px solid #99a0a6",r())}),slider_value.addEventListener("focusout",function(){o(),r()}),slider_value.addEventListener("keypress",function(e){13===e.keyCode&&(o(),r())})}}})}}getResponse(),btn.addEventListener("click",function(){popup.style.display="block"}),btn_close.addEventListener("click",function(){popup.style.display="none"});
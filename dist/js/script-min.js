"use strict";let services=document.querySelector(".calculator-services"),slider=document.querySelector("#volume"),slider_min=document.querySelector(".calculator-slider__value--min"),slider_max=document.querySelector(".calculator-slider__value--max"),slider_value=document.querySelector(".slider-value"),intres_value=document.querySelector(".intres-value"),instalment=document.querySelector("#instalment"),contract_value=document.querySelector(".contract-value"),contract_free=document.querySelector(".contract-fee"),contract_period=document.querySelector(".contract-period"),contract_total=document.querySelector(".contract-total"),period_select=document.querySelector("#period"),monthly_payment=document.querySelector(".monthly-payment"),btn=document.querySelector(".calculator__btn"),btn_close=document.querySelector(".close"),popup=document.querySelector(".popup"),runningValue=document.querySelector(".js-value");async function getResponse(){let e=await fetch("data.json"),t=await e.json();for(let e in t)for(let l in t[e]){let n=document.createElement("label"),r=document.createElement("input"),u=document.createElement("span");r.setAttribute("type","checkbox"),n.classList.add("service-item"),u.classList.add("checkmark"),n.innerHTML=t[e][l].name,services.append(n),n.append(r),n.append(u),r.addEventListener("change",function(){if(r.checked){let a=document.querySelectorAll("input[type=checkbox]");for(let e of a)e.checked=!1,e.parentElement.style.background="white";if(r.checked=!0,r.parentElement.style.background="#f7fafa",this.parentElement.textContent===t[e][l].name){slider.setAttribute("min",t[e][l].price_range[0]),slider.setAttribute("max",t[e][l].price_range[1]),slider_min.innerHTML=t[e][l].price_range[0]+" €",slider_max.innerHTML=t[e][l].price_range[1]+" €",slider.value=t[e][l].default_value,slider_value.value=t[e][l].default_value,contract_period.innerHTML=t[e][l].default_period+" kuud";let r=0,a=0,i=0;function n(){let n=0;for(let u in t[e][l].intres){n++;let o=Number(slider.value);0==i?slider_value.value=o:(slider_value.value=i,slider_value.value>t[e][l].price_range[1]?(i=t[e][l].price_range[1],slider_value.value=i):slider_value.value<t[e][l].price_range[0]?(console.log("dsada"),i=t[e][l].price_range[0],slider_value.value=i):slider.value=i);let c=u.split("-")[0],d=u.split("-")[1];if(o>c&&o<d){intres_value.innerHTML=t[e][l].intres[u],contract_value.innerHTML=t[e][l].contract_fee[n-1]+" €",contract_free.innerHTML=t[e][l].monthly_fee[n-1]+" €";let i,o,c,d=period_select.querySelectorAll("option");for(let e of d)e.remove();for(let u=1;u<=t[e][l].period[n-1]/6;u++){let n=document.createElement("option");n.innerHTML=6*u+" kuud",period_select.append(n),period_select.value=0==r?t[e][l].default_period+" kuud":r+" kuud"}i=0==r?(Number(slider.value)*t[e][l].intres[u].split("%")[0]/100+Number(slider.value)-a)/t[e][l].default_period:(Number(slider.value)*t[e][l].intres[u].split("%")[0]/100+Number(slider.value)-a)/r,o=0==r?t[e][l].contract_fee[n-1]/t[e][l].default_period:t[e][l].contract_fee[n-1]/r;let s=t[e][l].monthly_fee[n-1];c=0==r?(i+o+s)*t[e][l].default_period:(i+o+s)*r,monthly_payment.innerHTML=(i+o+s).toFixed(2)+" €",contract_total.innerHTML=c.toFixed(2)+" €"}}}function u(){i=slider_value.value}n(),period_select.value=t[e][l].default_period+" kuud",period_select.addEventListener("input",function(){contract_period.innerHTML=period_select.value,r=Number(period_select.value.split("kuud")[0]),n()}),slider.addEventListener("input",function(){let e=slider.value;runningValue.innerHTML=slider.value,runningValue.style.left=e/255+"%",runningValue.style.display="block",i=slider.value,n()}),slider.addEventListener("mouseup",function(){runningValue.style.display="none"}),instalment.addEventListener("focusout",function(){valuefunc(),n()}),instalment.addEventListener("keypress",function(e){13===e.keyCode&&((a=Number(instalment.value))>=slider.value?(a=0,instalment.value=0,instalment.style.borderBottom="3px solid #e03416"):instalment.style.borderBottom="3px solid #99a0a6",n())}),slider_value.addEventListener("focusout",function(){u(),n()}),slider_value.addEventListener("keypress",function(e){13===e.keyCode&&(u(),n())})}}else location.reload(!0)})}}getResponse(),btn.addEventListener("click",function(){popup.style.display="block"}),btn_close.addEventListener("click",function(){popup.style.display="none"});
"use strict";let services=document.querySelector(".calculator-services"),slider=document.querySelector("#volume"),slider_min=document.querySelector(".calculator-slider__value--min"),slider_max=document.querySelector(".calculator-slider__value--max"),slider_value=document.querySelector(".slider-value"),intres_value=document.querySelector(".intres-value"),instalment=document.querySelector("#instalment"),contract_value=document.querySelector(".contract-value"),contract_free=document.querySelector(".contract-fee"),contract_period=document.querySelector(".contract-period"),contract_total=document.querySelector(".contract-total"),period_select=document.querySelector("#period"),monthly_payment=document.querySelector(".monthly-payment"),btn=document.querySelector(".calculator__btn"),btn_close=document.querySelector(".close"),popup=document.querySelector(".popup"),runningValue=document.querySelector(".js-value");async function getResponse(){let e=await fetch("data.json"),t=await e.json();for(let e in t)for(let n in t[e]){let l=document.createElement("label"),r=document.createElement("input"),a=document.createElement("span");r.setAttribute("type","checkbox"),l.classList.add("service-item"),a.classList.add("checkmark"),l.innerHTML=t[e][n].name,services.append(l),l.append(r),l.append(a),r.addEventListener("change",function(){if(r.checked){let i=document.querySelectorAll("input[type=checkbox]");for(let e of i)e.checked=!1,e.parentElement.style.background="white";if(r.checked=!0,r.parentElement.style.background="#f7fafa",this.parentElement.textContent===t[e][n].name){slider.setAttribute("min",t[e][n].price_range[0]),slider.setAttribute("max",t[e][n].price_range[1]),slider_min.innerHTML=t[e][n].price_range[0]+" €",slider_max.innerHTML=t[e][n].price_range[1]+" €",slider.value=t[e][n].default_value,slider_value.value=t[e][n].default_value,contract_period.innerHTML=t[e][n].default_period+" kuud";let r=0,i=0,u=0;function l(){let l=0;for(let o in t[e][n].intres){l++;let c=Number(slider.value);0==u?slider_value.value=c:(slider_value.value=u,slider_value.value>t[e][n].price_range[1]?(u=t[e][n].price_range[1],slider_value.value=u):slider_value.value<t[e][n].price_range[0]?(u=t[e][n].price_range[0],slider_value.value=u):slider.value=u);let d=o.split("-")[0],s=o.split("-")[1];if(c>=d&&c<=s){intres_value.innerHTML=t[e][n].intres[o],contract_value.innerHTML=t[e][n].contract_fee[l-1]+" €",contract_free.innerHTML=t[e][n].monthly_fee[l-1]+" €";let u=period_select.querySelectorAll("option");for(let e of u)e.remove();for(let a=1;a<=t[e][n].period[l-1]/6;a++){let l=document.createElement("option");l.innerHTML=6*a+" kuud",period_select.append(l),period_select.value=0==r?t[e][n].default_period+" kuud":r+" kuud"}let c,d,s,p=Number(t[e][n].intres[o].split("%")[0]),m=Number(slider.value),_=0;function a(e,t,n,l){var r=parseFloat(n/100/12),a=parseFloat(12*l),o=(e-t)*(r*Math.pow(1+r,a)/(Math.pow(1+r,a)-1));c=Number(o.toFixed(2))}_=0==r?t[e][n].default_period/12:r/12,a(m,i,p,_),d=0==r?t[e][n].contract_fee[l-1]/t[e][n].default_period:t[e][n].contract_fee[l-1]/r;let v=t[e][n].monthly_fee[l-1];s=0==r?(c+d+v)*t[e][n].default_period:(c+d+v)*r,monthly_payment.innerHTML=(c+d+v).toFixed(2)+" €",contract_total.innerHTML=s.toFixed(2)+" €"}}}function a(){u=slider_value.value}function o(){(i=Number(instalment.value))>=slider.value?(i=0,instalment.value=0,instalment.style.borderBottom="3px solid #e03416"):instalment.style.borderBottom="3px solid #99a0a6"}l(),period_select.value=t[e][n].default_period+" kuud",period_select.addEventListener("input",function(){contract_period.innerHTML=period_select.value,r=Number(period_select.value.split("kuud")[0]),l()}),slider.addEventListener("input",function(){let e=slider.value;runningValue.innerHTML=slider.value,runningValue.style.left=e/255+"%",runningValue.style.display="block",u=slider.value,l()}),slider.addEventListener("mouseup",function(){runningValue.style.display="none"}),instalment.addEventListener("focusout",function(){o(),l()}),instalment.addEventListener("keypress",function(e){13===e.keyCode&&(o(),l())}),slider_value.addEventListener("focusout",function(){a(),l()}),slider_value.addEventListener("keypress",function(e){13===e.keyCode&&(a(),l())})}}else location.reload(!0)})}}getResponse(),btn.addEventListener("click",function(){popup.style.display="block"}),btn_close.addEventListener("click",function(){popup.style.display="none"});